<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="./output.css" rel="stylesheet" />
  </head>
  <body class="w-full h-dvh">
    <section class="w-full h-full flex">
      <div class="w-[95%] h-full flex flex-col">
        <header class="w-full h-auto p-2 gap-2">
          <img src="./assets/images/logo.png" alt="Logo da cintomante" />
        </header>
        <main
          class="w-full h-4/5 flex justify-center items-center flex-col gap-4"
        >
          <form class="w-full md:w-[50%] flex p-2">
            <div class="w-full flex flex-col md:flex-row gap-2 justify-center">
              <input
                type="file"
                id="file-upload"
                class="hidden"
                accept="image/*"
              />

              <button
                type="button"
                id="upload-button"
                class="bg-[#843E71] w-full md:w-[40%] text-white py-2 px-6 rounded-lg font-medium hover:cursor-pointer hover:bg-[#793667]"
              >
                Upload da imagem
              </button>

              <button
                type="button"
                id="analyze-button"
                class="bg-[#EEAB40] w-full md:w-[40%] py-2 px-6 rounded-lg font-medium hover:cursor-pointer hover:bg-[#e7a53a]"
              >
                Analisar Imagem
              </button>
            </div>
          </form>
          <div
            class="w-[90%] md:w-[50%] h-3/5 bg-[#D9D9D9] p-2 flex justify-center items-center"
          >
            <img
              id="image-preview"
              src="./assets/images/Image.png"
              alt="Imagem"
              class="max-w-full max-h-full object-contain w-full h-full"
            />
          </div>
          <div>
            <h2
              id="status-text"
              class="text-2xl font-bold md:text-4xl text-[#843E71] text-center"
            >
              Carregue a sua imagem!
            </h2>
          </div>
        </main>
      </div>
      <div
        class="h-full w-[5%] bg-gradient-to-b from-[#9773AA] via-[#C791E3] to-[#3C2E44]"
      ></div>
    </section>

<script>
  const uploadButton = document.getElementById("upload-button");
  const fileUploadInput = document.getElementById("file-upload");
  const imagePreview = document.getElementById("image-preview");
  const statusText = document.getElementById("status-text");

  uploadButton.addEventListener("click", () => {
    fileUploadInput.click();
  });

  fileUploadInput.addEventListener("change", (event) => {
    const file = event.target.files[0];

    if (file) {
      const reader = new FileReader();

      reader.onload = (e) => {
        imagePreview.src = e.target.result;
        statusText.textContent = "Imagem pronta para an√°lise!";
        statusText.classList.remove("text-green-500", "text-red-500");
        statusText.classList.add("text-[#843E71]");
      };

      reader.readAsDataURL(file);
    }
  });

  const analyzeButton = document.getElementById("analyze-button");

  analyzeButton.addEventListener("click", async () => {
    const file = fileUploadInput.files[0];

    if (!file) {
      statusText.textContent = "Por favor, selecione uma imagem primeiro!";
      statusText.classList.add("text-red-500");
      return; 
    }

    const formData = new FormData();
    formData.append("imagem", file);

    const apiUrl = "http://127.0.0.1:8000/api/upload/";
    statusText.textContent = "Analisando... üßê";

    try {
      const response = await fetch(apiUrl, {
        method: "POST",
        body: formData,
      });
      if (!response.ok) {
        throw new Error(`Erro na API: ${response.statusText}`);
      }

      const data = await response.json();

      console.log("Resposta da API:", data); 
      statusText.textContent = data.resultado; 

      if (data.resultado.toLowerCase().includes("parab√©ns")) {
        imagePreview.src = "./assets/images/success.png";
        statusText.classList.remove("text-red-500", "text-[#843E71]");
        statusText.classList.add("text-green-500");
      } else {
        imagePreview.src = "./assets/images/failure.png";
        statusText.classList.remove("text-green-500", "text-[#843E71]");
        statusText.classList.add("text-red-500");
      }

    } catch (error) {
      console.error("Falha ao analisar imagem:", error);
      statusText.textContent = "Erro ao conectar com o servidor. Tente novamente.";
      statusText.classList.add("text-red-500");
    }
  });
</script>
  </body>
</html>
